name = "flexio-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Worker configuration
workers_dev = true
# account_id = ""  # REQUIRED: Get from Cloudflare dashboard
# route = ""  # OPTIONAL: Custom route for production

# KV Namespace bindings
# Run: wrangler kv:namespace create "KV" to get the ID
# Run: wrangler kv:namespace create "KV" --preview to get the preview_id
kv_namespaces = [
  # REQUIRED: Create KV namespace with:
  #   wrangler kv:namespace create "KV"
  #   wrangler kv:namespace create "KV" --preview
  # Then replace the IDs below
  # { binding = "KV", id = "YOUR_KV_NAMESPACE_ID", preview_id = "YOUR_PREVIEW_KV_NAMESPACE_ID" }
]

# Limits
[limits]
# CPU time limit per request (ms)
cpu_ms = 50

# ============================================================
# Environment Variables Configuration
# ============================================================
# IMPORTANT: Copy workers/.env.example to workers/.env and update with your values
# Then update the [vars] section below with your actual configuration
#
# For sensitive values (JWT keys, admin tokens), use Wrangler secrets:
#   wrangler secret put JWT_PRIVATE_KEY
#   wrangler secret put JWT_PUBLIC_KEY
#   wrangler secret put ADMIN_TOKEN
# ============================================================

# Environment variables (non-secret)
[vars]
# REQUIRED: Update with your actual domain
ISSUER_URL = "https://your-domain.com"
# REQUIRED: Deploy Apps Script first, then update with the Web App URL
APPS_SCRIPT_URL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec"
# REQUIRED: Update with your frontend domain(s)
ALLOWED_ORIGINS = "http://localhost:5173,https://your-domain.com"

# External bbauth integration (OPTIONAL)
BBAUTH_PROVIDER_URL = ""
BBAUTH_CLIENT_ID = "flexio-client"
BBAUTH_CLIENT_SECRET = ""
BBAUTH_REDIRECT_URI = "http://localhost:8787/auth/bbauth/callback"
BBAUTH_SCOPE = "email"

# Production environment
[env.production]
vars = {
  ISSUER_URL = "https://your-domain.com",
  APPS_SCRIPT_URL = "https://script.google.com/macros/s/YOUR_PRODUCTION_SCRIPT_ID/exec",
  ALLOWED_ORIGINS = "https://your-domain.com",
  BBAUTH_PROVIDER_URL = "",
  BBAUTH_CLIENT_ID = "flexio-client",
  BBAUTH_CLIENT_SECRET = "",
  BBAUTH_REDIRECT_URI = "https://your-workers-subdomain.workers.dev/auth/bbauth/callback",
  BBAUTH_SCOPE = "email"
}

# Development environment
[env.dev]
vars = {
  ISSUER_URL = "http://localhost:8787",
  APPS_SCRIPT_URL = "https://script.google.com/macros/s/YOUR_DEV_SCRIPT_ID/exec",
  ALLOWED_ORIGINS = "http://localhost:5173,http://localhost:3000",
  BBAUTH_PROVIDER_URL = "",
  BBAUTH_CLIENT_ID = "flexio-client",
  BBAUTH_CLIENT_SECRET = "",
  BBAUTH_REDIRECT_URI = "http://localhost:8787/auth/bbauth/callback",
  BBAUTH_SCOPE = "email"
}

# Secrets (set with wrangler secret put)
# - JWT_PRIVATE_KEY
# - JWT_PUBLIC_KEY
# - ADMIN_TOKEN
# - BBAUTH_CLIENT_SECRET (if using external bbauth)

# Usage:
# wrangler secret put JWT_PRIVATE_KEY
# wrangler secret put JWT_PUBLIC_KEY
# wrangler secret put ADMIN_TOKEN
# wrangler secret put BBAUTH_CLIENT_SECRET  # Optional, for external bbauth
